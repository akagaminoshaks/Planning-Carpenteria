<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionale Carpenteria - Area Riservata</title>
    <style>
        /* STILE ORIGINALE MANTENUTO */
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #0f0f0f, #1a1a1a); color: white; margin: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        
        /* LOGIN BOX MODIFICATO PER EMAIL E PASSWORD */
        .box-card { background: rgba(20, 20, 20, 0.9); backdrop-filter: blur(20px); padding: 40px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); text-align: center; width: 320px; box-shadow: 0 0 50px rgba(0,0,0,0.5); z-index: 2000; }
        .input-field { width: 90%; padding: 15px; margin: 10px 0; border-radius: 8px; border: 1px solid #333; background: #000; color: white; font-size: 16px; outline: none; transition: 0.3s; }
        .input-field:focus { border-color: #E94560; }
        .btn-main { width: 100%; padding: 15px; border-radius: 8px; border: none; background: #E94560; color: white; font-weight: bold; cursor: pointer; font-size:14px; text-transform: uppercase; margin-top: 20px; transition: 0.3s; }
        .btn-main:hover { background: #ff6b81; }
        
        /* MENU PRINCIPALE (Nascosto all'inizio) */
        .menu-container { display: none; gap: 20px; width: 95%; max-width: 1300px; height: 70vh; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .vertical-card { flex: 1; border-radius: 30px; border: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; padding: 20px; text-align: center; background: rgba(255,255,255,0.05); position: relative; overflow: hidden; }
        .vertical-card:hover { transform: translateY(-10px); border-color: white; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        /* COLORI CARDS */
        .card-ordini { background: linear-gradient(180deg, rgba(200, 30, 30, 0.8) 0%, rgba(60, 20, 20, 0.9) 100%); }
        .card-planning { background: linear-gradient(180deg, rgba(30, 30, 30, 0.9) 0%, rgba(0, 0, 0, 0.95) 100%); }
        .card-acquisti { background: linear-gradient(180deg, rgba(39, 174, 96, 0.8) 0%, rgba(20, 90, 50, 0.9) 100%); }
        .card-toolbox { background: linear-gradient(180deg, rgba(255, 159, 67, 0.8) 0%, rgba(211, 84, 0, 0.9) 100%); }

        .card-title { font-size: 22px; font-weight: 800; text-transform: uppercase; margin-bottom: 10px; z-index: 2; }
        .card-desc { font-size: 13px; opacity: 0.7; z-index: 2; }

        /* HEADER UTENTE E LOGOUT */
        #user-bar { position: absolute; top: 20px; right: 20px; display: none; align-items: center; gap: 15px; }
        .user-email { font-size: 12px; color: #888; }
        .btn-logout { background: transparent; border: 1px solid #444; color: #ccc; padding: 5px 15px; border-radius: 20px; cursor: pointer; font-size: 11px; }
        .btn-logout:hover { border-color: #E94560; color: #E94560; }
        
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 1000; display: flex; justify-content: center; align-items: center; }
        .error-msg { color: #e74c3c; font-size: 12px; margin-top: 10px; display: none; }
    </style>
</head>
<body>

    <div id="user-bar">
        <span class="user-email" id="display-email"></span>
        <button class="btn-logout" id="btn-logout">ESCI ðŸ”’</button>
    </div>

    <div id="login-screen">
        <div class="box-card">
            <h2 style="margin-top:0; color:#E94560;">OFFICINA</h2>
            <p style="color:#666; font-size:12px; margin-bottom:20px;">ACCESSO RISERVATO</p>
            <input type="email" id="email" class="input-field" placeholder="Email">
            <input type="password" id="password" class="input-field" placeholder="Password">
            <button id="btn-login" class="btn-main">ENTRA</button>
            <p id="login-error" class="error-msg">Email o Password errati</p>
        </div>
    </div>

    <div class="menu-container" id="main-menu">
        <div class="vertical-card card-ordini" onclick="vaiA('commesse.html')">
            <div class="card-title">COMMESSE</div><div class="card-desc">Produzione & Materiali</div>
        </div>
        <div class="vertical-card card-planning" onclick="vaiA('planning.html')">
            <div class="card-title">PLANNING</div><div class="card-desc">Ore Lavoro & WhatsApp</div>
        </div>
        <div class="vertical-card card-acquisti" onclick="vaiA('acquisti.html')">
            <div class="card-title">ACQUISTI</div><div class="card-desc">Ordini & Fornitori</div>
        </div>
        <div class="vertical-card card-toolbox" onclick="vaiA('toolbox.html')">
            <div class="card-title">TOOLBOX</div><div class="card-desc">Calcoli & UtilitÃ </div>
        </div>
    </div>

    <script type="module">
        // Importa le funzioni di Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // CONFIGURAZIONE COMPLETA (Copiata dal tuo file planning.html)
        const firebaseConfig = { 
            apiKey: "AIzaSyCfFDdtzkZLClamp-Z_iODl8KQbBevEAfg", 
            authDomain: "planner-carpenteria.firebaseapp.com", 
            databaseURL: "https://planner-carpenteria-default-rtdb.europe-west1.firebasedatabase.app", 
            projectId: "planner-carpenteria", 
            storageBucket: "planner-carpenteria.firebasestorage.app", 
            messagingSenderId: "926532216818", 
            appId: "1:926532216818:web:927f43972c81bbf580ed6b" 
        };

        // Inizializza Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // Elementi HTML
        const loginScreen = document.getElementById('login-screen');
        const mainMenu = document.getElementById('main-menu');
        const userBar = document.getElementById('user-bar');
        const errorMsg = document.getElementById('login-error');

        // 1. CONTROLLO AUTOMATICO (Sei giÃ  loggato?)
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Utente loggato: Crea il pass per le altre pagine
                localStorage.setItem('auth_token', 'logged_in');

                // Nascondi login, mostra menu
                loginScreen.style.display = 'none';
                mainMenu.style.display = 'flex';
                userBar.style.display = 'flex';
                document.getElementById('display-email').innerText = user.email;
            } else {
                // Utente sloggato: Rimuovi il pass
                localStorage.removeItem('auth_token');

                // Mostra login
                loginScreen.style.display = 'flex';
                mainMenu.style.display = 'none';
                userBar.style.display = 'none';
            }
        });

        // 2. FUNZIONE LOGIN (Quando premi ENTRA)
        document.getElementById('btn-login').addEventListener('click', () => {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;

            signInWithEmailAndPassword(auth, email, pass)
                .then((userCredential) => {
                    // Successo! Il controllo automatico sopra farÃ  il resto
                    errorMsg.style.display = 'none';
                })
                .catch((error) => {
                    console.error(error);
                    errorMsg.style.display = 'block';
                    errorMsg.innerText = "Errore: Controlla email e password";
                });
        });

        // Abilita il tasto invio per fare login
        document.getElementById('password').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') document.getElementById('btn-login').click();
        });

        // 3. FUNZIONE LOGOUT (Quando premi ESCI)
        document.getElementById('btn-logout').addEventListener('click', () => {
            signOut(auth).then(() => {
                // Sign-out successful.
                window.location.reload();
            }).catch((error) => {
                // An error happened.
            });
        });

        // Funzione navigazione
        window.vaiA = function(pagina) {
            window.location.href = pagina;
        }
    </script>
</body>
</html>